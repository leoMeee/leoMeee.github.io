---
layout: post
title:  "字符编码原理"
date:   2017/3/18
categories: 笔记
tags: 笔记
---

## PHP字符串有几种表达方式？
- 单引号
- 双引号
- heredoc 语法结构
- nowdoc  语法结构（PHP5.3）

### 双引号解析的字符
- `变量`将会被解析。
- 一些转义字符：**\n , \r , \t , \v , \e , \f , \\ , \$ , \" **

### 单引号解析的字符
单引号只转义单引号 ( **\'** )和反斜线( **\\** )

## 底层C语言中怎么表示PHP字符串？
 字符串在C语言底层实际上是结构体的形式。所以php中可以用[]或者{}访问某个字符

### **常见函数都是以单字节处理字符串**
>比如字符串长度 strlen，字符串截取 substr，都是以单字节处理字符串。可以使用mb_ 系列函数处理字符串，指定字符编码。

### PHP字符串是二进制安全的
>【二进制安全】在PHP文档里，基本就是这么一个意思：C语言里的功能类似的函数会对有的字符特别处理，而PHP这个函数对于所有字符一视同仁，不用担心会有特殊字符影响处理，特别不用担心编码0字符。

## 位、字节、字符
- **位(bit)** 是计算机中最小的数据单位。每一位的状态只能是 **0** 或 **1**。
- 8个二进制位构成1个"字节(Byte)"。
**1个字节**一共可以用**8个二进制位**来表示**256**种不同的**状态**，每一个状态对应一个符号，就是256个符号，从**0000000**到**11111111**
1个字节可以储存1个英文字母或者半个汉字
- **字符**（ Character ）是指计算机中使用的字母、数字、汗字和符号等

## 字符集和字符编码
- **字符集**（Charset）：是一个系统支持的所有抽象字符的集合。
- **字符编码**（Character Encoding）：是一套法则，使字符集与计算机之间建立对应关系，就是将字符转换为计算机可以接受的数字代码。就是以二进制的数字来对应字符集的字符。

## ASCII码
上个世纪60年代，美国制定了一套字符编码，对英语字符与二进制位之间的关系，做了统一规定。这被称为ASCII码，一直沿用至今。
ASCII码划分为两个集合：128个字符的**标准ASCII码**和附加的128个字符的**扩充ASCII码**。

### 标准ASCII码
标准**ASCII码**一共规定了**128个字符**的编码，比如空格"SPACE"是32（二进制00100000），大写的字母A是65（二进制01000001）。这128个符号（包括32个不能打印出来的控制符号），**只占用了一个字节的后面7位**，**最前面的1位统一规定为0**。

### 扩充ASCII码
ISO-8859-1编码是单字节编码，向下兼容ASCII，是ASCII 的扩展的一种
此字符集支持部分于欧洲使用的语言
**Latin1**是ISO-8859-1的别名，有些环境下写作**Latin-1**。


## 非ASCII编码

- 英语用128个符号编码就够了，但是用来表示其他语言，128个符号是不够的。
- 欧洲国家使用的编码体系，可以表示最多256个符号。
- 亚洲国家的文字，使用的符号就更多了，必须使用多个字节表达一个符号。
- 比如，简体中文常见的编码方式是GB2312，使用**两个字节**表示**一个汉字**，所以理论上最多可以表示256x256=65536个符号。
- **世界上存在着多种编码方式**。

### GB2312和GBK

- 早期的计算机使用7位的ASCII编码，为了处理汉字，程序员设计了用于**简体中文**的**GB2312**和用于**繁体中文**的**big5**
- GB2312支持的汉字太少。1995年的汉字扩展规范**GBK**1.0收录了21886个符号
- 2000年的**GB18030**是取代GBK1.0的正式国家标准。
- GB2312、GBK到GB18030都属于**双字节**字符集
- 从ASCII、GB2312、GBK到GB18030，这些编码方法是**向下兼容**的，即同一个字符在这些方案中总是有相同的编码，后面的标准支持更多的字符

#### GB2312的编码规则
gb2312由**区位码**转换成**国标码**，由国标码转换成机内码

##### 区位码
有一个区位码表：

![Alt text](/assets/img/1445226986384.png)

- 这个方阵实际上组成一个有94个区（编号由01到94），每个区有94个位（编号由01到94）的汉字字符集。
- 一个汉字所在的区号和位号的组合就构成了该汉字的"区位码"。其中，高两位为**区号**，低两位为**位号**。这样区位码可以唯一地确定某一汉字或字符
- 如“保”字在代码表中处于17区第3位，区位码即“1703 ”。

##### 国标码
- 国标码是由区位码稍作转换得到，是一个汉字国家标准的二进制编码。
- 区码和位码分别加20H后转换成国标码
例如：区位码5448,其中区码54（十六进制36H）位码48（十六进制30H）
36H+20H->56H,30H+20H->50H,所以该字国标码为5650H

##### 机内码
- 国标码＋8080H＝机内码
- 比如: 国标码是3473H， 3473H＋8080H＝B4F3H，得到机内码为B4F3H
- **机内码是一个汉字在计算机内部保存的编码。**


### Unicode
- 世界上存在着多种编码方式，同一个二进制数字可以被解释成不同的符号。
- Unicode的目的就是统一世界上所有的编码方式
- Unicode,是一个很大的集合，现在的规模可以容纳100多万个符号。

#### Unicode的问题
**Unicode只是一个字符集**，它只规定了符号的二进制代码，却没有规定这个二进制代码应该如何存储。
也就是说**Unicode没有规定一个字符用几个字节表示**
>如果Unicode统一规定，每个符号用三个或四个字节表示，那么每个英文字母前都必然有二到三个字节是0，这对于存储来说是极大的浪费，文本文件的大小会因此大出二三倍，这是无法接受的。

它们造成的结果是：
1. 出现了Unicode的多种存储方式，有许多种不同的二进制格式，可以用来表示Unicode。
2. Unicode在很长一段时间内无法推广，直到互联网的出现。

#### UTF-8

- **UTF-8是在互联网上使用最广的一种Unicode的字符编码方案**

- 其他实现方式还包括UTF-16（字符用两个字节或四个字节表示）和UTF-32（字符用四个字节表示），不过在互联网上基本不用。

#### UTF-8的编码规则

- UTF-8最大的一个特点，就是它是一种**变长的编码方式**。它可以使**用1~4个字节表示一个符号，根据不同的符号而变化字节长度**。

- UTF-8的编码规则很简单，只有二条：
	1. 对于单字节的符号，字节的第一位设为0，后面7位为这个符号的unicode码。因此**对于英语字母，UTF-8编码和ASCII码是相同的**。

	2. 对于n字节的符号（n>1），第一个字节的前n位都设为1，第n+1位设为0，后面字节的前两位一律设为10。剩下的没有提及的二进制位，全部为这个符号的unicode码。因此，**如果第一位是1，则连续有多少个1，就表示当前字符占用多少个字节**。如：110xxxxx 10xxxxxx 11110xxx

- **UTF-8 中汉字占3个字节**

#### 什么是BOM
- BOM用来表明字节顺序，在头部占`3个字符`
- UTF-8 不需要bom，UTF-16才需要
- UTF-8 如果有bom，可以通过把文件前三个字符去掉的办法转成无bom

-------------
#### 参考
- [字符编码笔记：ASCII，Unicode和UTF-8](http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html)
- [程序员趣味读物：谈谈Unicode编码](http://www.pconline.com.cn/pcedu/empolder/gj/other/0505/616631.html)